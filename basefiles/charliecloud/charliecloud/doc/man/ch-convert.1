.\" Man page generated from reStructuredText.
.
.TH "CH-CONVERT" "1" "2023-06-28 11:54 -0400" "0.33" "Charliecloud"
.SH NAME
ch-convert \- Convert an image from one format to another
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.SH SYNOPSIS
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ ch\-convert [\-i FMT] [\-o FMT] [OPTION ...] IN OUT
.ft P
.fi
.UNINDENT
.UNINDENT
.SH DESCRIPTION
.sp
Copy image \fBIN\fP to \fBOUT\fP and convert its format. Replace
\fBOUT\fP if it already exists, unless \fB\-\-no\-clobber\fP is specified. It
is an error if \fBIN\fP and \fBOUT\fP have the same format; use the
format’s own tools for that case.
.sp
\fBch\-run\fP can run container images that are plain directories or
(optionally) SquashFS archives. However, images can take on a variety of other
formats as well. The main purpose of this tool is to make images in those
other formats available to \fBch\-run\fP\&.
.sp
For best performance, \fBch\-convert\fP should be invoked only once,
producing the final format actually needed.
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.TP
.B \fBIN\fP
Descriptor for the input image. For image builders, this is an image
reference; otherwise, it’s a filesystem path.
.TP
.B \fBOUT\fP
Descriptor for the output image.
.TP
.B \fB\-h\fP, \fB\-\-help\fP
Print help and exit.
.TP
.B \fB\-i\fP, \fB\-\-in\-fmt FMT\fP
Input image format is \fBFMT\fP\&. If omitted, inferred as described below.
.TP
.B \fB\-n\fP, \fB\-\-dry\-run\fP
Don’t read the input or write the output. Useful for testing format
inference.
.TP
.B \fB\-\-no\-clobber\fP
Error if \fBOUT\fP already exists, rather than replacing it.
.TP
.B \fB\-o\fP, \fB\-\-out\-fmt FMT\fP
Output image format is \fBFMT\fP; inferred if omitted.
.TP
.B \fB\-s\fP, \fB\-\-storage DIR\fP
Set the storage directory. Equivalent to the same option for \fBch\-image(1)\fP
and \fBch\-run(1)\fP\&.
.TP
.B \fB\-\-tmp DIR\fP
A sub\-directory for temporary storage is created in \fBDIR\fP and
removed at the end of a successful conversion. \fBIf this script crashes or
errors out, the temporary directory is left behind to assist in
debugging.\fP Storage may be needed up to twice the uncompressed size of
the image, depending on the input and output formats. Default:
\fB$TMPDIR\fP if specified; otherwise \fB/var/tmp\fP\&.
.TP
.B \fB\-v\fP, \fB\-\-verbose\fP
Print extra chatter. Can be repeated.
.UNINDENT
.UNINDENT
.UNINDENT
.SH IMAGE FORMATS
.sp
\fBch\-convert\fP knows about these values of \fBFMT\fP:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.TP
.B \fBch\-image\fP
Internal storage for Charliecloud’s unprivileged image builder (Dockerfile
interpreter) \fBch\-image\fP\&.
.TP
.B \fBdir\fP
Ordinary filesystem directory (i.e., not a mount point) containing an
unpacked image. Output directories that already exist are replaced if they
look like an image. If the output directory is empty, the conversion should
use the directory without overwriting it. If the directory doesn’t look like
an image and isn’t empty, exit with an error.
.TP
.B \fBdocker\fP
Internal storage for Docker.
.TP
.B \fBpodman\fP
Internal storage for Podman.
.TP
.B \fBsquash\fP
SquashFS filesystem archive containing the flattened image. SquashFS
archives are much like tar archives but are mountable, including by
\fBch\-run\fP’s internal SquashFUSE mounting. Most systems have at least
the SquashFS\-Tools installed which allows unpacking into a directory, just
like tar. Due to this greater flexibility, SquashFS is preferred to tar.
.sp
\fBNote:\fP Conversions to and from SquashFS are quite noisy due to the
verbosity of the underlying \fBmksquashfs(1)\fP and
\fBunsquashfs(1)\fP tools.
.TP
.B \fBtar\fP
Tar archive containing the flattened image with no layer sub\-archives;
i.e., the output of \fBdocker export\fP works but the output of
\fBdocker save\fP does not. Output tarballs are always gzipped and must
end in \fB\&.tar.gz\fP; input tarballs can be any compression acceptable
to \fBtar(1)\fP\&.
.UNINDENT
.UNINDENT
.UNINDENT
.sp
All of these are local formats; \fBch\-convert\fP does not know how to push
or pull images.
.SH FORMAT INFERENCE
.sp
\fBch\-convert\fP tries to save typing by guessing formats when they are
reasonably clear. This is done against filenames, rather than file contents,
so the rules are the same for output descriptors that do not yet exist.
.sp
Format inference is done for both \fBIN\fP and \fBOUT\fP\&. The first
matching glob below yields the inferred format. Paths need not exist in the
filesystem.
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP 1. 3
\fB*.sqfs\fP, \fB*.squash\fP, \fB*.squashfs\fP: SquashFS.
.IP 2. 3
\fB*.tar\fP, \fB*.t?z\fP, \fB*.tar.?\fP, \fB*.tar.??\fP: Tarball.
.IP 3. 3
\fB/*\fP, \fB\&./*\fP, i.e. absolute path or relative path with
explicit dot: Directory.
.IP 4. 3
If \fIch\-image\fP is installed: \fBch\-image\fP internal storage.
.IP 5. 3
If Podman is installed: Podman internal storage.
.IP 6. 3
If Docker is installed: Docker internal storage.
.IP 7. 3
Otherwise: No format inference.
.UNINDENT
.UNINDENT
.UNINDENT
.SH EXAMPLES
.sp
Typical build\-to\-run sequence for image \fBfoo/bar\fP using \fBch\-run\fP’s
internal SquashFUSE code, inferring the output format:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ sudo docker build \-t foo/bar \-f Dockerfile .
[...]
$ ch\-convert foo/bar:latest /var/tmp/foobar.sqfs
input:   docker    foo/bar:latest
output:  squashfs  /var/tmp/foobar.sqfs
copying ...
done
$ ch\-run /var/tmp/foobar.sqfs \-\- echo hello
hello
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Same conversion, but no format inference:
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ ch\-convert \-i ch\-image \-o squash foo/bar:latest /var/tmp/foobar.sqfs
input:   docker    foo/bar:latest
output:  squashfs  /var/tmp/foobar.sqfs
copying ...
done
.ft P
.fi
.UNINDENT
.UNINDENT
.SH REPORTING BUGS
.sp
If Charliecloud was obtained from your Linux distribution, use your
distribution’s bug reporting procedures.
.sp
Otherwise, report bugs to: \fI\%https://github.com/hpc/charliecloud/issues\fP
.SH SEE ALSO
.sp
charliecloud(7)
.sp
Full documentation at: <\fI\%https://hpc.github.io/charliecloud\fP>
.SH COPYRIGHT
2014–2022, Triad National Security, LLC and others
.\" Generated by docutils manpage writer.
.
