.\" Man page generated from reStructuredText.
.
.TH "CH-RUN-OCI" "1" "2023-06-28 11:54 -0400" "0.33" "Charliecloud"
.SH NAME
ch-run-oci \- OCI wrapper for "ch-run"
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.SH SYNOPSIS
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ ch\-run\-oci OPERATION [ARG ...]
.ft P
.fi
.UNINDENT
.UNINDENT
.SH DESCRIPTION
.sp
\fBNOTE:\fP
.INDENT 0.0
.INDENT 3.5
This command is experimental. Features may be incomplete and/or buggy. The
quality of code is not yet up to the usual Charliecloud standards, and
error handling is poor. Please report any issues you find, so we can fix
them!
.UNINDENT
.UNINDENT
.sp
Open Containers Initiative (OCI) wrapper for \fBch\-run(1)\fP\&. You probably
don’t want to run this command directly; it is intended to interface with
other software that expects an OCI runtime. The current goal is to support
completely unprivileged image building (e.g. \fBbuildah
\-\-runtime=ch\-run\-oci\fP) rather than general OCI container running.
.sp
\fISupport of the OCI runtime specification is only partial.\fP This is for two
reasons. First, it’s an experimental and incomplete feature. More importantly,
the philosophy and goals of OCI differ significantly from those of
Charliecloud. Key differences include:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
OCI is designed to run services, while Charliecloud is designed to run
scientific applications.
.IP \(bu 2
OCI containers are persistent things with a complex lifecycle, while
Charliecloud containers are simply UNIX processes.
.IP \(bu 2
OCI expects support for a variety of namespaces, while Charliecloud
supports user and mount, no more and no less.
.IP \(bu 2
OCI expects runtimes to maintain a supervisor process in addition to
user processes; Charliecloud has no need for this.
.IP \(bu 2
OCI expects runtimes to maintain state throughout the container lifecycle
in a location independent from the caller.
.UNINDENT
.UNINDENT
.UNINDENT
.sp
For these reasons, \fBch\-run\-oci\fP is a bit of a kludge, and much of what
it does is provide scaffolding to satisfy OCI requirements.
.sp
Which OCI features are and are not supported is provided in the rest of this
man page, and technical analysis and discussion are in the Contributor’s
Guide.
.sp
This command supports OCI version 1.0.0 only and fails with an error if other
versions are offered.
.SH OPERATIONS
.sp
All OCI operations are accepted, but some are no\-ops or merely scaffolding to
satisfy the caller. For comparison, see also:
.INDENT 0.0
.IP \(bu 2
\fI\%OCI runtime and lifecycle spec\fP
.IP \(bu 2
The \fI\%runc man pages\fP
.UNINDENT
.SS \fBcreate\fP
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ ch\-run\-oci create \-\-bundle DIR \-\-pid\-file FILE [\-\-no\-new\-keyring] CONTAINER_ID
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Create a container. Charliecloud does not have separate create and start
phases, so this operation only sets up OCI\-related scaffolding.
.sp
Arguments:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.TP
.B \fB\-\-bundle DIR\fP
Directory containing the OCI bundle. This must be \fB/tmp/buildahYYY\fP,
where \fBYYY\fP matches \fBCONTAINER_ID\fP below.
.TP
.B \fB\-\-pid\-file FILE\fP
Filename to write the “container” process PID to. Note that for
Charliecloud, the process given is fake; see above. This must be
\fBDIR/pid\fP, where \fBDIR\fP is given by \fB\-\-bundle\fP\&.
.TP
.B \fB\-\-no\-new\-keyring\fP
Ignored. (Charliecloud does not implement session keyrings.)
.TP
.B \fBCONTAINER_ID\fP
String to use as the container ID. This must be
\fBbuildah\-buildahYYY\fP, where \fBYYY\fP matches \fBDIR\fP above.
.UNINDENT
.UNINDENT
.UNINDENT
.sp
Unsupported arguments:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.TP
.B \fB\-\-console\-socket PATH\fP
UNIX socket to pass pseudoterminal file descriptor. Charliecloud does not
support pseudoterminals; fail with an error if this argument is given. For
Buildah, redirect its input from \fB/dev/null\fP to prevent it from
requesting a pseudoterminal.
.UNINDENT
.UNINDENT
.UNINDENT
.SS \fBdelete\fP
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ ch\-run\-oci delete CONTAINER_ID
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Clean up the OCI\-related scaffolding for specified container.
.SS \fBkill\fP
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ ch\-run\-oci kill CONTAINER_ID
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
No\-op.
.SS \fBstart\fP
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ ch\-run\-oci start CONTAINER_ID
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Eexecute the user command specified at create time in a Charliecloud
container.
.SS \fBstate\fP
.INDENT 0.0
.INDENT 3.5
.sp
.nf
.ft C
$ ch\-run\-oci state CONTAINER_ID
.ft P
.fi
.UNINDENT
.UNINDENT
.sp
Print the state of the given container on standard output as an OCI compliant
JSON document.
.SH UNSUPPORTED OCI FEATURES
.sp
As noted above, various OCI features are not supported by Charliecloud. We
have tried to guess which features would be essential to callers;
\fBch\-run\-oci\fP fails with an error if these are requested. Otherwise, the
request is simply ignored.
.sp
We are interested in hearing about scientific\-computing use cases for
unsupported features, so we can add support for things that are needed.
.sp
Our goal is for this man page to be comprehensive: every OCI runtime feature
should either work or be listed as unsupported.
.sp
Unsupported features that are an error:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
Pseudoterminals
.IP \(bu 2
Hooks (prestart, poststart, and prestop)
.IP \(bu 2
Annotations
.IP \(bu 2
Joining existing namespaces
.IP \(bu 2
Intel Resource Director Technology (RDT)
.UNINDENT
.UNINDENT
.UNINDENT
.sp
Unsupported features that are ignored:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
Mounts other than the root filesystem
.IP \(bu 2
User/group mappings beyond one user mapped to EUID and one group mapped to
EGID
.IP \(bu 2
Disabling \fBprctl(PR_SET_NO_NEW_PRIVS)\fP
.IP \(bu 2
Root filesystem propagation mode
.IP \(bu 2
\fBsysctl\fP directives
.IP \(bu 2
masked and read\-only paths (remaining unprivileged protects you)
.IP \(bu 2
Capabilities
.IP \(bu 2
rlimits
.IP \(bu 2
Devices (all devices are inherited from the host)
.IP \(bu 2
cgroups
.IP \(bu 2
seccomp
.IP \(bu 2
SELinux
.IP \(bu 2
AppArmor
.IP \(bu 2
Container hostname setting
.UNINDENT
.UNINDENT
.UNINDENT
.SH ENVIRONMENT VARIABLES
.INDENT 0.0
.TP
.B \fBCH_LOG_FILE\fP
If set, append log chatter to this file, rather than standard error. This is
useful for debugging situations where standard error is consumed or lost.
.sp
Also sets verbose mode if not already set (equivalent to \fB\-\-verbose\fP).
.TP
.B \fBCH_LOG_FESTOON\fP
If set, prepend PID and timestamp to logged chatter.
.UNINDENT
.sp
\fBCH_RUN_OCI_HANG\fP
.INDENT 0.0
.INDENT 3.5
If set to the name of a command (e.g., \fBcreate\fP), sleep indefinitely
when that command is invoked. The purpose here is to halt a build so it can
be examined and debugged.
.UNINDENT
.UNINDENT
.SH REPORTING BUGS
.sp
If Charliecloud was obtained from your Linux distribution, use your
distribution’s bug reporting procedures.
.sp
Otherwise, report bugs to: \fI\%https://github.com/hpc/charliecloud/issues\fP
.SH SEE ALSO
.sp
charliecloud(7)
.sp
Full documentation at: <\fI\%https://hpc.github.io/charliecloud\fP>
.SH COPYRIGHT
2014–2022, Triad National Security, LLC and others
.\" Generated by docutils manpage writer.
.
