Only in ./new_batsim: build
Only in ./new_batsim: ccu-docs
Common subdirectories: ./batsim/ci and ./new_batsim/ci
Common subdirectories: ./batsim/contrib and ./new_batsim/contrib
diff '--exclude=.git*' ./batsim/copyright ./new_batsim/copyright
17,31d16
< 
< Files: src/docopt/*
< Copyright: 2013 Jared Grubb. All rights reserved.
< License: Expat
< Comment: See details in the source directory
< 
< Files: src/pugixml-1.7/*
< Copyright: 2006-2017 Arseny Kapoulkine
< License: Expat
< 
< Files: cmake/Modules/Findrapidjson.cmake
< Copyright:
<   2011 Milo Yip (miloyip@gmail.com)
<   2013 Rafal Jeczalik (rjeczalik@gmail.com)
< License: Expat
diff '--exclude=.git*' ./batsim/default.nix ./new_batsim/default.nix
5a6,10
> , coverageCobertura ? false
> , coverageCoveralls ? false
> , coverageGcovTxt ? false
> , coverageHtml ? false
> , coverageSonarqube ? false
8a14
> , useClang ? false
10c16,24
< , batsched ? kapack.batsched-master
---
> , batsched ? kapack.batsched.overrideAttrs (old: {
>     src = kapack.pkgs.fetchFromGitLab {
>       domain = "framagit.org";
>       owner = "batsim";
>       repo = "batsched";
>       rev = "17072778995100fc90214ea4910bf5b171adfd0d";
>       sha256 = "12r8b14rwa26wx34l1492vdvyn2s7mch3ixlz46s6imi1ximywa8";
>     };
>   })
12c26,37
< , pybatsim ? kapack.pybatsim-master
---
> , pybatsim ? kapack.pybatsim.overrideAttrs (old: {
>     src = kapack.pkgs.fetchFromGitLab {
>       domain = "gitlab.inria.fr";
>       owner = "batsim";
>       repo = "pybatsim";
>       rev = "880dd60c537d7d7a8246daaf5b2d1f7bfea3cbf4";
>       sha256 = "1xa0r1h8xv1x51v0zddw3m52n250wph8jsm1ga67v18k7582kav4";
>     };
>   })
> # set this to avoid running tests over and over
> # (e.g., to debug coverage reports or to run tests and coverage report separately)
> , testVersion ? toString builtins.currentTime
17c42
<   pythonPackages = pkgs.python37Packages;
---
>   pythonPackages = pkgs.python3Packages;
19a45,48
>   #custom-stdenv-base = if useClang then pkgs.llvmPackages_11.stdenv else pkgs.gcc11Stdenv;
>   custom-stdenv-base = if useClang then pkgs.clangStdenv else pkgs.gccStdenv;
>   custom-stdenv = if debug then (pkgs.stdenvAdapters.keepDebugInfo custom-stdenv-base) else custom-stdenv-base;
> 
24c53
<     batsim = (kapack.batsim.override { inherit debug simgrid; }).overrideAttrs (attr: rec {
---
>     batsim = (kapack.batsim.override { inherit debug simgrid; stdenv = custom-stdenv; }).overrideAttrs (attr: rec {
34a64,65
>       patches = [];
>       mesonBuildType = if debug then "debug" else "release";
38a70
>       ninjaFlags = [ "-v" ];
49,50c81,82
<         cp batlib@sta/*.gcno $out/gcno/
<         cp batsim@exe/*.gcno $out/gcno/
---
>         cp batsim.p/*.gcno $out/gcno/
>         cp libbatlib.a.p/*.gcno $out/gcno/
53c85
<         cp batlib@sta/*.gcda $out/gcda/
---
>         cp libbatlib.a.p/*.gcda $out/gcda/
79a112,121
>     # Shell used by CI to push coverage results on codecov's infrastructure.
>     codecov_push_shell = pkgs.mkShell rec {
>       name = "codecov-push-shell";
>       buildInputs = [
>         pkgs.curl
>         pkgs.git
>         pkgs.python3Packages.codecov
>       ];
>     };
> 
83c125
<       version = toString builtins.currentTime;
---
>       version = testVersion;
94a137,139
>         "^workloads/usage-trace"
>         "^workloads/usage-trace/.*"
>         "^workloads/usage-trace/.*/.*\.txt"
98c143
<       buildInputs = with pkgs.python37Packages; [
---
>       buildInputs = with pkgs.python3Packages; [
100c145
<         pybatsim pytest pytest_html pandas] ++
---
>         pybatsim pytest pytest-html pandas] ++
137a183,224
>     # Generate coverage reports, from gcov traces in batsim and batsim_integration_tests.
>     coverage-report = pkgs.stdenv.mkDerivation rec {
>       pname = "batsim-coverage-report";
>       version = integration_tests.version;
> 
>       buildInputs = batsim.buildInputs ++ [ kapack.gcovr ]
>         ++ [ batsim integration_tests ];
>       src = batsim.src;
> 
>       buildPhase = ''
>         mkdir cov-merged
>         cd cov-merged
>         cp ${batsim}/gcno/* ${integration_tests}/gcda/* ./
>         gcov -p *.gcno
>         mkdir report
>       '' + pkgs.lib.optionalString coverageHtml ''
>         mkdir -p report/html
>       '' + pkgs.lib.optionalString coverageGcovTxt ''
>         mkdir -p report/gcov-txt
>         cp \^\#src\#*.gcov report/gcov-txt/
>       '' + ''
>         gcovr -g -k -r .. --filter '\.\./src/' \
>           --txt report/file-summary.txt \
>           --csv report/file-summary.csv \
>           --json-summary report/file-summary.json \
>         '' + pkgs.lib.optionalString coverageCobertura ''
>           --xml report/cobertura.xml \
>         '' + pkgs.lib.optionalString coverageCoveralls ''
>           --coveralls report/coveralls.json \
>         '' + pkgs.lib.optionalString coverageHtml ''
>           --html-details report/html/index.html \
>         '' + pkgs.lib.optionalString coverageSonarqube ''
>           --sonarqube report/sonarqube.xml \
>         '' + ''
>           --print-summary
>       '';
>       installPhase = ''
>         mkdir -p $out
>         cp -r report/* $out/
>       '';
>     };
> 
171,172c258,261
<         "^\.travis\.yml"
<         "^release.nix"
---
>         "^\.github"
>         "^\.github/workflows"
>         "^\.github/workflows/build-docker-containers.yml"
>         "^default.nix"
189a279,281
>         "^docs/tuto-app-model"
>         "^docs/tuto-app-model/.*\.rst"
>         "^docs/tuto-app-model/.*\.svg"
222,248d313
<     };
< 
<     # Dependencies not in nixpkgs as I write these lines.
<     pytest_metadata = buildPythonPackage {
<       name = "pytest-metadata-1.8.0";
<       doCheck = false;
<       propagatedBuildInputs = [
<         pythonPackages.pytest
<         pythonPackages.setuptools_scm
<       ];
<       src = builtins.fetchurl {
<         url = "https://files.pythonhosted.org/packages/12/38/eed3a1e00c765e4da61e4e833de41c3458cef5d18e819d09f0f160682993/pytest-metadata-1.8.0.tar.gz";
<         sha256 = "1fk6icip2x1nh4kzhbc8cnqrs77avpqvj7ny3xadfh6yhn9aaw90";
<       };
<     };
< 
<     pytest_html = buildPythonPackage {
<       name = "pytest-html-1.20.0";
<       doCheck = false;
<       propagatedBuildInputs = [
<         pythonPackages.pytest
<         pytest_metadata
<       ];
<       src = builtins.fetchurl {
<         url = "https://files.pythonhosted.org/packages/08/3e/63d998f26c7846d3dac6da152d1b93db3670538c5e2fe18b88690c1f52a7/pytest-html-1.20.0.tar.gz";
<         sha256 = "17jyn4czkihrs225nkpj0h113hc03y0cl07myb70jkaykpfmrim7";
<       };
Only in ./batsim: demo
Common subdirectories: ./batsim/doc and ./new_batsim/doc
Common subdirectories: ./batsim/docs and ./new_batsim/docs
Common subdirectories: ./batsim/env and ./new_batsim/env
Common subdirectories: ./batsim/events and ./new_batsim/events
diff '--exclude=.git*' ./batsim/meson.build ./new_batsim/meson.build
2c2
<     version: '4.0.0',
---
>     version: '4.1.0',
20d19
< add_project_link_arguments(['-lstdc++fs'], language : 'cpp')
28a28,38
> 
> add_project_arguments(['-Wno-error'],language: 'cpp')
> 
> # old gcc/llvm c++ std libraries have implemented the filesystem lib in a separate lib
> # - https://releases.llvm.org/11.0.1/projects/libcxx/docs/UsingLibcxx.html#using-filesystem
> # - https://gcc.gnu.org/gcc-9/changes.html
> if meson.get_compiler('cpp').get_id() == 'clang' and meson.get_compiler('cpp').version().version_compare('<9.0')
>   add_project_link_arguments(['-lstdc++fs'], language : 'cpp')
> elif meson.get_compiler('cpp').get_id() == 'gcc' and meson.get_compiler('cpp').version().version_compare('<9.0')
>   add_project_link_arguments(['-lstdc++fs'], language : 'cpp')
> endif
Common subdirectories: ./batsim/platforms and ./new_batsim/platforms
Common subdirectories: ./batsim/publications and ./new_batsim/publications
diff '--exclude=.git*' ./batsim/README.rst ./new_batsim/README.rst
34c34
< .. |internal-issues| image:: https://img.shields.io/badge/internal%20issues-github-orange.svg
---
> .. |internal-issues| image:: https://img.shields.io/badge/internal%20issues-gitlab%20inria-orange.svg
45c45
< .. |last-release| image:: https://img.shields.io/badge/release-v4.0.0-blue.svg
---
> .. |last-release| image:: https://img.shields.io/badge/release-v4.1.0-blue.svg
48c48
<     :target: https://github.com/oar-team/batsim/releases/tag/v4.0.0
---
>     :target: https://github.com/oar-team/batsim/releases/tag/v4.1.0
50c50
< .. |distance-from-previous-release| image:: https://img.shields.io/github/commits-since/oar-team/batsim/v4.0.0.svg
---
> .. |distance-from-previous-release| image:: https://img.shields.io/github/commits-since/oar-team/batsim/v4.1.0.svg
53c53
<     :target: https://github.com/oar-team/batsim/compare/v4.0.0...HEAD
---
>     :target: https://github.com/oar-team/batsim/compare/v4.1.0...HEAD
Only in ./batsim: release.nix
Common subdirectories: ./batsim/src and ./new_batsim/src
Common subdirectories: ./batsim/test and ./new_batsim/test
Common subdirectories: ./batsim/tools and ./new_batsim/tools
Only in ./batsim: .travis.yml
Common subdirectories: ./batsim/workloads and ./new_batsim/workloads
